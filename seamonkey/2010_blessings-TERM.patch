https://github.com/erikrose/blessings/pull/137

Fixes: https://bugs.gentoo.org/654316

From 5fefc65c306cf9ec492e7b422d6bb4842385afbc Mon Sep 17 00:00:00 2001
From: Jay Kamat <jaygkamat@gmail.com>
Date: Fri, 24 Aug 2018 11:11:57 -0700
Subject: [PATCH 1/2] Fix error when TERM is unset or improperly set

diff -urN seamonkey-2.53.13.orig/python/mach/mach/logging.py seamonkey-2.53.13/python/mach/mach/logging.py
--- seamonkey-2.53.13.orig/python/mach/mach/logging.py	2021-05-25 20:33:38.000000000 +0200
+++ seamonkey-2.53.13/python/mach/mach/logging.py	2022-07-13 10:13:18.628115170 +0200
@@ -93,7 +93,7 @@
 
     def set_terminal(self, terminal):
         self.terminal = terminal
-        self._sgr0 = blessings.tigetstr('sgr0') or '' if terminal and blessings else ''
+        self._sgr0 = terminal.normal if terminal and blessings else ''
 
     def format(self, record):
         f = record.msg.format(**record.params)
diff -urN seamonkey-2.53.13.orig/third_party/python/blessings/blessings/__init__.py seamonkey-2.53.13/third_party/python/blessings/blessings/__init__.py
--- seamonkey-2.53.13.orig/third_party/python/blessings/blessings/__init__.py	2022-06-08 21:10:29.000000000 +0200
+++ seamonkey-2.53.13/third_party/python/blessings/blessings/__init__.py	2022-07-13 10:11:37.537812167 +0200
@@ -94,8 +94,13 @@
             # init sequences to the stream if it has a file descriptor, and
             # send them to stdout as a fallback, since they have to go
             # somewhere.
-            setupterm(kind or environ.get('TERM', 'unknown'),
-                      self._init_descriptor)
+            try:
+               setupterm(kind or environ.get('TERM', 'dumb') or 'dumb',
+                         self._init_descriptor)
+            except curses.error:
+               # There was an error setting up the terminal, either curses is
+               # not supported or TERM is incorrectly set. Fall back to dumb.
+               self._does_styling = False
 
         self.stream = stream
 
